# .htaccess para eLunch - Optimización de Performance y SEO
# Hosting: Hostinger
# Última actualización: 26 de Enero 2026

# ============================================
# COMPRESIÓN GZIP
# ============================================
<IfModule mod_deflate.c>
  # Comprimir HTML, CSS, JavaScript, Text, XML y fuentes
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
</IfModule>

# ============================================
# CACHÉ DEL NAVEGADOR
# ============================================
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Imágenes - Caché por 1 año
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # Videos - Caché por 1 año
  ExpiresByType video/mp4 "access plus 1 year"
  ExpiresByType video/webm "access plus 1 year"
  
  # CSS y JavaScript - Caché por 1 mes
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/x-javascript "access plus 1 month"
  
  # Fuentes - Caché por 1 año
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  
  # HTML - Caché por 1 hora
  ExpiresByType text/html "access plus 1 hour"
  
  # XML y JSON - Caché por 1 día
  ExpiresByType application/xml "access plus 1 day"
  ExpiresByType application/json "access plus 1 day"
  ExpiresByType text/xml "access plus 1 day"
  
  # Favicon - Caché por 1 año
  ExpiresByType image/vnd.microsoft.icon "access plus 1 year"
  
  # Default - Caché por 1 semana
  ExpiresDefault "access plus 1 week"
</IfModule>

# ============================================
# HEADERS DE CACHÉ (Alternativo)
# ============================================
<IfModule mod_headers.c>
  # Imágenes - 1 año
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
    Header set Cache-Control "max-age=31536000, public, immutable"
  </FilesMatch>
  
  # CSS y JavaScript - 1 mes
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "max-age=2592000, public"
  </FilesMatch>
  
  # Fuentes - 1 año
  <FilesMatch "\.(ttf|otf|woff|woff2|eot)$">
    Header set Cache-Control "max-age=31536000, public, immutable"
  </FilesMatch>
  
  # HTML - Sin caché (siempre actualizado)
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "max-age=3600, public, must-revalidate"
  </FilesMatch>
</IfModule>

# ============================================
# HEADERS DE SEGURIDAD Y CORS
# ============================================
<IfModule mod_headers.c>
  # Prevenir MIME type sniffing
  Header always set X-Content-Type-Options "nosniff"
  
  # Protección XSS
  Header always set X-XSS-Protection "1; mode=block"
  
  # Prevenir clickjacking (SAMEORIGIN permite_same_domain)
  Header always set X-Frame-Options "SAMEORIGIN"
  
  # Referrer Policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # CORS para API - Permitir llamadas desde el mismo dominio
  <FilesMatch "^api/">
    Header always set Access-Control-Allow-Origin "https://mielunch.com"
    Header always set Access-Control-Allow-Methods "POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type"
  </FilesMatch>
  
  # Permissions Policy (antes Feature-Policy)
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# ============================================
# REDIRECCIONES WWW Y HTTPS
# ============================================
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Redirigir de HTTP a HTTPS
  RewriteCond %{HTTPS} off
  RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
  
  # Redirigir de non-www a www
  RewriteCond %{HTTP_HOST} !^www\. [NC]
  RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]
</IfModule>

# ============================================
# TIPOS MIME PARA WEBP
# ============================================
<IfModule mod_mime.c>
  AddType image/webp .webp
  AddType image/svg+xml .svg .svgz
  AddEncoding gzip .svgz
</IfModule>

# ============================================
# PREVENIR LISTADO DE DIRECTORIOS
# ============================================
Options -Indexes

# ============================================
# PÁGINAS DE ERROR PERSONALIZADAS (Opcional)
# ============================================
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html

# ============================================
# PROTECCIÓN CONTRA HOTLINKING DE IMÁGENES
# ============================================
<IfModule mod_rewrite.c>
  RewriteEngine On
  # Permitir solo desde tu dominio y dominios autorizados
  RewriteCond %{HTTP_REFERER} !^$
  RewriteCond %{HTTP_REFERER} !^https?://(www\.)?mielunch\.com [NC]
  RewriteCond %{HTTP_REFERER} !^https?://(www\.)?google\.com [NC]
  RewriteCond %{HTTP_REFERER} !^https?://(www\.)?facebook\.com [NC]
  RewriteCond %{HTTP_REFERER} !^https?://(www\.)?instagram\.com [NC]
  # Bloquear imágenes pero no favicon
  RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [F,NC]
</IfModule>

# ============================================
# UTF-8 ENCODING
# ============================================
AddDefaultCharset UTF-8

# ============================================
# DESACTIVAR ETAGS (Mejor performance)
# ============================================
<IfModule mod_headers.c>
  Header unset ETag
</IfModule>
FileETag None

# ============================================
# LÍMITE DE TAMAÑO DE SUBIDA (Si es necesario)
# ============================================
# php_value upload_max_filesize 20M
# php_value post_max_size 20M

# ============================================
# FIN DE CONFIGURACIÓN
# ============================================
# Creado por: OpenCode AI
# Fecha: 26 de Enero 2026
# Sitio: www.mielunch.com
